from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
import json

@csrf_exempt
def ai_chat_api(request):
    if request.method == 'POST':
        try:
            body = json.loads(request.body)
            prompt = body.get("text", "")

            # ðŸŽ¯ Your AI logic or OpenAI call here
            if "report" in prompt.lower():
                return JsonResponse({
                    "messages": [
                        {
                            "role": "ai",
                            "type": "text",
                            "text": "Hereâ€™s your report: [Download PDF](/media/report.pdf)"
                        }
                    ]
                })

            # Default reply
            return JsonResponse({
                "messages": [
                    {
                        "role": "ai",
                        "type": "text",
                        "text": f"You said: {prompt}"
                    }
                ]
            })

        except Exception as e:
            return JsonResponse({"error": str(e)}, status=400)

    return JsonResponse({"error": "Invalid request method"}, status=405)
